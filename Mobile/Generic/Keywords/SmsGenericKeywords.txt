*** Settings ***
Resource          ../../Andriod/Keywords/SmsMoodKeywords.txt
Resource          ../../iOS/Keywords/SmsIosKeywords.txt

*** Keywords ***
Wait SMS
    [Arguments]    ${os}    ${totalSms}    ${timeout}    ${sender}=all
    Comment    Log    In Wait SMS
    Run Keyword If    '${os}' == 'Android'    mood Wait SMS    ${totalSms}    ${timeout}    ${sender}
    Run Keyword If    '${os}' == 'iOS'    ios Wait SMS    ${totalSms}    ${timeout}    ${sender}
    Comment    Log    Out Wait SMS

Open SMS App
    [Arguments]    ${remoteUrl}    ${platformName}    ${platformVersion}    ${udid}
    Comment    Log    In Open SMS App
    Comment    Log    ${remoteUrl}
    Comment    Log    ${platformName}
    Comment    Log    ${platformVersion}
    Comment    Log    ${udid}
    Run Keyword If    '${platformName}' == 'Android'    mood Open SMS App    ${remoteUrl}    ${platformName}    ${platformVersion}    ${udid}
    Run Keyword If    '${platformName}' == 'iOS'    ios Open SMS App    ${remoteUrl}    ${platformName}    ${platformVersion}    ${udid}
    Comment    Log    Out Open SMS App

Read SMS
    [Arguments]    ${os}    ${sender}    ${totalSms}
    Log    In Read SMS
    Comment    Log    ${os}
    @{messages}=    Create List
    @{messages}=    Run Keyword If    '${os}' == 'Android'    mood Read SMS    ${sender}    ${totalSms}
    ...    ELSE IF    '${os}' == 'iOS'    ios Read SMS    ${sender}    ${totalSms}
    Log List    ${messages}
    Log    Out Read SMS
    [Return]    ${messages}

Clear All Unread SMS
    [Arguments]    ${os}
    Log    In Clear All Unread SMS
    Log    ${os}
    Run Keyword If    '${os}' == 'Android'    mood Clear All Unread SMS
    ...    ELSE IF    '${os}' == 'iOS'    Log To Console    Welcome iOS
    Comment    Log    Out Read All SMS

Wait and Verify SMS
    [Arguments]    ${platformName}    ${TotalSMS}    ${SenderName}    ${MessageExpect}    ${Timeout}=10
    [Documentation]    You must Create List for send List to ${MessageExpect}
    ...    EX
    ...    @{MessageExpect} \ \ \ \ \ Create List ${MessageOne} \ \ \ \ ${MessageTwo}
    ...
    ...    Wait and Verify SMS \ \ \ \ \ \ ${virtual_3PO_2_Platfrom_Name} \ \ \ \ \ \ 1 \ \ ${SenderName} \ \ \ \ @{MessageExpect} \ \ \ \ \ 15
    Log    In Wait and Verify SMS
    sleep    2
    Wait SMS    ${platformName}    ${TotalSMS}    ${Timeout}
    @{messages}=    Read SMS    ${platformName}    ${SenderName}    ${TotalSMS}
    ${lengthOfMsgExpect}    Get Length    ${MessageExpect}
    ${indexOfExpect}    Set Variable    0
    : FOR    ${indexOfExpect}    IN RANGE    ${lengthOfMsgExpect}
    \    Verify SMS    ${TotalSMS}    ${messages}    ${indexOfExpect}    ${MessageExpect}
    \    ${indexOfExpect}    Evaluate    ${indexOfExpect}+1
    Log    Out Wait and Verify SMS

Close SMS App
    [Arguments]    ${platformName}    ${udid}
    Run Keyword If    '${platformName}' == 'Android'    mood Close SMS App    ${platformName}    ${udid}
    Run Keyword If    '${platformName}' == 'iOS'    FAIL    Not Implement

Verify SMS
    [Arguments]    ${TotalSMS}    ${messages}    ${indexOfExpect}    ${MessageExpect}
    ${indexOfActual}    Set Variable    0
    ${result}    Evaluate    ${TotalSMS}-1
    : FOR    ${indexOfActual}    IN RANGE    ${TotalSMS}
    \    Log    @{MessageExpect}[${indexOfExpect}]
    \    Log    @{messages}[${indexOfActual}]
    \    Run Keyword If    '@{MessageExpect}[${indexOfExpect}]'== '@{messages}[${indexOfActual}]'    Exit For Loop
    \    Run Keyword If    ${indexOfActual}==${result}    Fail    Message did not match...
    \    ${indexOfActual}    Evaluate    ${indexOfActual}+1
